---
title: 'Reproducible Research: Peer Assessment 1'
output:
  html_document:
    keep_md: yes
  pdf_document: default
---

Set locale to English and load ggplot2 library
```{r results = "hide"}
library(ggplot2)
Sys.setlocale("LC_TIME", "C")
```

## Loading and preprocessing the data
Load the data.
```{r}
# unzip file if it doesn't exist yet
if (!file.exists("activity.csv")) {
    unzip("activity.zip")
}

# read in csv file
activity <- read.csv("activity.csv")
```


## What is mean total number of steps taken per day?
Calculate the total number of steps taken per day ignoring missing values.
```{r}
# take sum of steps factorized by date
steps <- tapply(activity$steps, activity$date, function(x) sum(x, na.rm = TRUE))
# histogram of the total number of steps taken each day
hist(steps, xlab = "Number of steps")
steps_mean <- round(mean(steps), digits = 2)
steps_median <- median(steps)
```
mean of total number of steps taken per day: `r steps_mean`  
median of total number of steps taken per day: `r steps_median`


## What is the average daily activity pattern?
Make a time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)
```{r}
# take mean of steps factorized by interval
interval_steps <- tapply(activity$steps, activity$interval, function(x) mean(x, na.rm = TRUE))
plot(interval_steps, type = "l", xlab = "Interval", ylab = "Number of steps")
max_interval <- names(which(interval_steps == max(interval_steps)))
```
5-minute interval containing maximum number of steps: `r max_interval`

## Imputing missing values

The strategy is to take the mean of a 5-minute interval and assign it to a missing value in that interval.

```{r}
sum(is.na(activity))
activity_full <- activity
sum(is.na(activity_full))
for (i in 1 : nrow(activity_full)) {
    if (is.na(activity_full$steps[i])) {
        activity_full$steps[i] <- interval_steps[as.character(activity_full$interval[i])]
    }
}
sum(is.na(activity_full))

steps_full <- tapply(activity_full$steps, activity_full$date, function(x) sum(x, na.rm = TRUE))
hist(steps_full)
mean(steps_full)
median(steps_full)
```

Yes, they differ because less steps get taken into account. With missing values, there will be less steps for each day.


## Are there differences in activity patterns between weekdays and weekends?
```{r}
daytype <- vector("integer")
for (i in 1 : nrow(activity_full)) {
    if (is.element(weekdays(as.Date(activity_full$date[i])), c("Saturday", "Sunday"))) {
        daytype[i] <- 1
    } else {
        daytype[i] <- 0
    }
}
activity_full$daytype <- factor(daytype, labels = c("weekday", "weekend"))
qplot(activity_full$interval, activity_full$steps, activity_full, facets = . ~ daytype, geom = "line")

```